import{_ as i,o as u,c as r,a as s,b as a,w as d,d as n,e as k,r as t}from"./app.f10a4800.js";var v="/PolarDB-for-PostgreSQL/assets/curve-cluster.77966d1c.png";const m={},b={id:"curvebs-\u5171\u4EAB\u5B58\u50A8",tabindex:"-1"},h=s("a",{class:"header-anchor",href:"#curvebs-\u5171\u4EAB\u5B58\u50A8","aria-hidden":"true"},"#",-1),g=n(" CurveBS \u5171\u4EAB\u5B58\u50A8 "),f={href:"https://developer.aliyun.com/live/250218"},_={href:"https://github.com/opencurve/curve",target:"_blank",rel:"noopener noreferrer"},y=n("Curve"),S=n(" \u662F\u4E00\u6B3E\u9AD8\u6027\u80FD\u3001\u6613\u8FD0\u7EF4\u3001\u4E91\u539F\u751F\u7684\u5F00\u6E90\u5206\u5E03\u5F0F\u5B58\u50A8\u7CFB\u7EDF\u3002\u53EF\u5E94\u7528\u4E8E\u4E3B\u6D41\u7684\u4E91\u539F\u751F\u57FA\u7840\u8BBE\u65BD\u5E73\u53F0\uFF1A"),x=s("ul",null,[s("li",null,"\u5BF9\u63A5 OpenStack \u5E73\u53F0\u4E3A\u4E91\u4E3B\u673A\u63D0\u4F9B\u9AD8\u6027\u80FD\u5757\u5B58\u50A8\u670D\u52A1\uFF1B"),s("li",null,"\u5BF9\u63A5 Kubernetes \u4E3A\u5176\u63D0\u4F9B RWO\u3001RWX \u7B49\u7C7B\u578B\u7684\u6301\u4E45\u5316\u5B58\u50A8\u5377\uFF1B"),s("li",null,"\u5BF9\u63A5 PolarFS \u4F5C\u4E3A\u4E91\u539F\u751F\u6570\u636E\u5E93\u7684\u9AD8\u6027\u80FD\u5B58\u50A8\u5E95\u5EA7\uFF0C\u5B8C\u7F8E\u652F\u6301\u4E91\u539F\u751F\u6570\u636E\u5E93\u7684\u5B58\u7B97\u5206\u79BB\u67B6\u6784\u3002")],-1),$=s("p",null,"Curve \u4EA6\u53EF\u4F5C\u4E3A\u4E91\u5B58\u50A8\u4E2D\u95F4\u4EF6\u4F7F\u7528 S3 \u517C\u5BB9\u7684\u5BF9\u8C61\u5B58\u50A8\u4F5C\u4E3A\u6570\u636E\u5B58\u50A8\u5F15\u64CE\uFF0C\u4E3A\u516C\u6709\u4E91\u7528\u6237\u63D0\u4F9B\u9AD8\u6027\u4EF7\u6BD4\u7684\u5171\u4EAB\u6587\u4EF6\u5B58\u50A8\u3002",-1),C=n("\u672C\u793A\u4F8B\u5C06\u5F15\u5BFC\u60A8\u4EE5 CurveBS \u4F5C\u4E3A\u5757\u5B58\u50A8\uFF0C\u90E8\u7F72 PolarDB for PostgreSQL\u3002\u66F4\u591A\u8FDB\u9636\u914D\u7F6E\u548C\u4F7F\u7528\u65B9\u6CD5\u8BF7\u53C2\u8003 Curve \u9879\u76EE\u7684 "),P={href:"https://github.com/opencurve/curveadm/wiki",target:"_blank",rel:"noopener noreferrer"},B=n("wiki"),O=n("\u3002"),K=s("h2",{id:"\u8BBE\u5907\u51C6\u5907",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#\u8BBE\u5907\u51C6\u5907","aria-hidden":"true"},"#"),n(" \u8BBE\u5907\u51C6\u5907")],-1),D=s("p",null,[s("img",{src:v,alt:"curve-cluster"})],-1),I=s("p",null,"\u5982\u56FE\u6240\u793A\uFF0C\u672C\u793A\u4F8B\u5171\u4F7F\u7528\u516D\u53F0\u670D\u52A1\u5668\u3002\u5176\u4E2D\uFF0C\u4E00\u53F0\u4E2D\u63A7\u670D\u52A1\u5668\u548C\u4E09\u53F0\u5B58\u50A8\u670D\u52A1\u5668\u5171\u540C\u7EC4\u6210 CurveBS \u96C6\u7FA4\uFF0C\u5BF9\u5916\u66B4\u9732\u4E3A\u4E00\u4E2A\u5171\u4EAB\u5B58\u50A8\u670D\u52A1\u3002\u5269\u4F59\u4E24\u53F0\u670D\u52A1\u5668\u5206\u522B\u7528\u4E8E\u90E8\u7F72 PolarDB for PostgreSQL \u6570\u636E\u5E93\u7684\u8BFB\u5199\u8282\u70B9\u548C\u53EA\u8BFB\u8282\u70B9\uFF0C\u5B83\u4EEC\u5171\u4EAB CurveBS \u5BF9\u5916\u66B4\u9732\u7684\u5757\u5B58\u50A8\u8BBE\u5907\u3002",-1),F=n("\u672C\u793A\u4F8B\u4F7F\u7528\u963F\u91CC\u4E91 ECS \u6A21\u62DF\u5168\u90E8\u516D\u53F0\u670D\u52A1\u5668\u3002\u516D\u53F0 ECS \u5168\u90E8\u8FD0\u884C "),L={href:"https://openanolis.cn/anolisos",target:"_blank",rel:"noopener noreferrer"},U=n("Anolis OS"),w=n(" 8.6\uFF08\u517C\u5BB9 CentOS 8.6\uFF09\u7CFB\u7EDF\uFF0C\u4F7F\u7528 root \u7528\u6237\uFF0C\u5E76\u5904\u4E8E\u540C\u4E00\u5C40\u57DF\u7F51\u6BB5\u5185\u3002\u9700\u8981\u5B8C\u6210\u7684\u51C6\u5907\u5DE5\u4F5C\u5305\u542B\uFF1A"),q=n("\u5728\u5168\u90E8\u673A\u5668\u4E0A\u5B89\u88C5 "),E={href:"https://www.docker.com/",target:"_blank",rel:"noopener noreferrer"},R=n("Docker"),A=n("\uFF08\u8BF7\u53C2\u8003 Docker \u5B98\u65B9\u6587\u6863\uFF09"),H=s("li",null,"\u5728 Curve \u4E2D\u63A7\u673A\u4E0A\u914D\u7F6E SSH \u514D\u5BC6\u767B\u9646\u5230\u5176\u5B83\u4E94\u53F0\u670D\u52A1\u5668",-1),N=k(`<h2 id="\u5728\u4E2D\u63A7\u673A\u4E0A\u5B89\u88C5-curveadm" tabindex="-1"><a class="header-anchor" href="#\u5728\u4E2D\u63A7\u673A\u4E0A\u5B89\u88C5-curveadm" aria-hidden="true">#</a> \u5728\u4E2D\u63A7\u673A\u4E0A\u5B89\u88C5 CurveAdm</h2><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">bash</span> -c <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -fsSL https://curveadm.nos-eastchina1.126.net/script/install.sh<span class="token variable">)</span></span>&quot;</span>
<span class="token builtin class-name">source</span> /root/.bash_profile
</code></pre></div><h2 id="\u5BFC\u5165\u4E3B\u673A\u5217\u8868" tabindex="-1"><a class="header-anchor" href="#\u5BFC\u5165\u4E3B\u673A\u5217\u8868" aria-hidden="true">#</a> \u5BFC\u5165\u4E3B\u673A\u5217\u8868</h2><p>\u5728\u4E2D\u63A7\u673A\u4E0A\u7F16\u8F91\u4E3B\u673A\u5217\u8868\u6587\u4EF6\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">vim</span> hosts.yaml
</code></pre></div><p>\u6587\u4EF6\u4E2D\u5305\u542B\u53E6\u5916\u4E94\u53F0\u670D\u52A1\u5668\u7684 IP \u5730\u5740\u548C\u5728 Curve \u96C6\u7FA4\u5185\u7684\u540D\u79F0\uFF0C\u5176\u4E2D\uFF1A</p><ul><li>\u4E09\u53F0\u4E3B\u673A\u4E3A Curve \u5B58\u50A8\u8282\u70B9\u4E3B\u673A</li><li>\u4E24\u53F0\u4E3B\u673A\u4E3A PolarDB for PostgreSQL \u8BA1\u7B97\u8282\u70B9\u4E3B\u673A</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">global</span><span class="token punctuation">:</span>
  <span class="token key atrule">user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">ssh_port</span><span class="token punctuation">:</span> <span class="token number">22</span>
  <span class="token key atrule">private_key_file</span><span class="token punctuation">:</span> /root/.ssh/id_rsa

<span class="token key atrule">hosts</span><span class="token punctuation">:</span>
  <span class="token comment"># Curve worker nodes</span>
  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> server<span class="token punctuation">-</span>host1
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> 172.16.0.223
  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> server<span class="token punctuation">-</span>host2
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> 172.16.0.224
  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> server<span class="token punctuation">-</span>host3
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> 172.16.0.225
  <span class="token comment"># PolarDB nodes</span>
  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> polardb<span class="token punctuation">-</span>primary
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> 172.16.0.226
  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> polardb<span class="token punctuation">-</span>replica
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> 172.16.0.227
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5BFC\u5165\u4E3B\u673A\u5217\u8868\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code>curveadm hosts commit hosts.yaml
</code></pre></div><h2 id="\u683C\u5F0F\u5316\u78C1\u76D8" tabindex="-1"><a class="header-anchor" href="#\u683C\u5F0F\u5316\u78C1\u76D8" aria-hidden="true">#</a> \u683C\u5F0F\u5316\u78C1\u76D8</h2><p>\u51C6\u5907\u78C1\u76D8\u5217\u8868\uFF0C\u5E76\u63D0\u524D\u751F\u6210\u4E00\u6279\u56FA\u5B9A\u5927\u5C0F\u5E76\u9884\u5199\u8FC7\u7684 chunk \u6587\u4EF6\u3002\u78C1\u76D8\u5217\u8868\u4E2D\u9700\u8981\u5305\u542B\uFF1A</p><ul><li>\u5C06\u8981\u8FDB\u884C\u683C\u5F0F\u5316\u7684\u6240\u6709\u5B58\u50A8\u8282\u70B9\u4E3B\u673A</li><li>\u6BCF\u53F0\u4E3B\u673A\u4E0A\u7684\u7EDF\u4E00\u5757\u8BBE\u5907\u540D\uFF08\u672C\u4F8B\u4E2D\u4E3A <code>/dev/vdb</code>\uFF09</li><li>\u5C06\u88AB\u4F7F\u7528\u7684\u6302\u8F7D\u70B9</li><li>\u683C\u5F0F\u5316\u767E\u5206\u6BD4</li></ul><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">vim</span> format.yaml
</code></pre></div><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">host</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> server<span class="token punctuation">-</span>host1
  <span class="token punctuation">-</span> server<span class="token punctuation">-</span>host2
  <span class="token punctuation">-</span> server<span class="token punctuation">-</span>host3
<span class="token key atrule">disk</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> /dev/vdb<span class="token punctuation">:</span>/data/chunkserver0<span class="token punctuation">:</span><span class="token number">90</span> <span class="token comment"># device:mount_path:format_percent</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5F00\u59CB\u683C\u5F0F\u5316\u3002\u6B64\u65F6\uFF0C\u4E2D\u63A7\u673A\u5C06\u5728\u6BCF\u53F0\u5B58\u50A8\u8282\u70B9\u4E3B\u673A\u4E0A\u5BF9\u6BCF\u4E2A\u5757\u8BBE\u5907\u542F\u52A8\u4E00\u4E2A\u683C\u5F0F\u5316\u8FDB\u7A0B\u5BB9\u5668\u3002</p><div class="language-bash ext-sh"><pre class="language-bash"><code>$ curveadm <span class="token function">format</span> -f format.yaml
Start Format Chunkfile Pool: \u2838
  + <span class="token assign-left variable">host</span><span class="token operator">=</span>server-host1  <span class="token assign-left variable">device</span><span class="token operator">=</span>/dev/vdb  <span class="token assign-left variable">mountPoint</span><span class="token operator">=</span>/data/chunkserver0  <span class="token assign-left variable">usage</span><span class="token operator">=</span><span class="token number">90</span>% <span class="token punctuation">[</span><span class="token number">0</span>/1<span class="token punctuation">]</span> \u2838
  + <span class="token assign-left variable">host</span><span class="token operator">=</span>server-host2  <span class="token assign-left variable">device</span><span class="token operator">=</span>/dev/vdb  <span class="token assign-left variable">mountPoint</span><span class="token operator">=</span>/data/chunkserver0  <span class="token assign-left variable">usage</span><span class="token operator">=</span><span class="token number">90</span>% <span class="token punctuation">[</span><span class="token number">0</span>/1<span class="token punctuation">]</span> \u2838
  + <span class="token assign-left variable">host</span><span class="token operator">=</span>server-host3  <span class="token assign-left variable">device</span><span class="token operator">=</span>/dev/vdb  <span class="token assign-left variable">mountPoint</span><span class="token operator">=</span>/data/chunkserver0  <span class="token assign-left variable">usage</span><span class="token operator">=</span><span class="token number">90</span>% <span class="token punctuation">[</span><span class="token number">0</span>/1<span class="token punctuation">]</span> \u2838
</code></pre></div><p>\u5F53\u663E\u793A <code>OK</code> \u65F6\uFF0C\u8BF4\u660E\u8FD9\u4E2A\u683C\u5F0F\u5316\u8FDB\u7A0B\u5BB9\u5668\u5DF2\u542F\u52A8\uFF0C\u4F46 <strong>\u5E76\u4E0D\u4EE3\u8868\u683C\u5F0F\u5316\u5DF2\u7ECF\u5B8C\u6210</strong>\u3002\u683C\u5F0F\u5316\u662F\u4E2A\u8F83\u4E45\u7684\u8FC7\u7A0B\uFF0C\u5C06\u4F1A\u6301\u7EED\u4E00\u6BB5\u65F6\u95F4\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code>Start Format Chunkfile Pool: <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
  + <span class="token assign-left variable">host</span><span class="token operator">=</span>server-host1  <span class="token assign-left variable">device</span><span class="token operator">=</span>/dev/vdb  <span class="token assign-left variable">mountPoint</span><span class="token operator">=</span>/data/chunkserver0  <span class="token assign-left variable">usage</span><span class="token operator">=</span><span class="token number">90</span>% <span class="token punctuation">[</span><span class="token number">1</span>/1<span class="token punctuation">]</span> <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
  + <span class="token assign-left variable">host</span><span class="token operator">=</span>server-host2  <span class="token assign-left variable">device</span><span class="token operator">=</span>/dev/vdb  <span class="token assign-left variable">mountPoint</span><span class="token operator">=</span>/data/chunkserver0  <span class="token assign-left variable">usage</span><span class="token operator">=</span><span class="token number">90</span>% <span class="token punctuation">[</span><span class="token number">1</span>/1<span class="token punctuation">]</span> <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
  + <span class="token assign-left variable">host</span><span class="token operator">=</span>server-host3  <span class="token assign-left variable">device</span><span class="token operator">=</span>/dev/vdb  <span class="token assign-left variable">mountPoint</span><span class="token operator">=</span>/data/chunkserver0  <span class="token assign-left variable">usage</span><span class="token operator">=</span><span class="token number">90</span>% <span class="token punctuation">[</span><span class="token number">1</span>/1<span class="token punctuation">]</span> <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
</code></pre></div><p>\u53EF\u4EE5\u901A\u8FC7\u4EE5\u4E0B\u547D\u4EE4\u67E5\u770B\u683C\u5F0F\u5316\u8FDB\u5EA6\uFF0C\u76EE\u524D\u4ECD\u5728\u683C\u5F0F\u5316\u72B6\u6001\u4E2D\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ curveadm <span class="token function">format</span> --status
Get Format Status: <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>

Host          Device    MountPoint          Formatted  Status
----          ------    ----------          ---------  ------
server-host1  /dev/vdb  /data/chunkserver0  <span class="token number">19</span>/90      Formatting
server-host2  /dev/vdb  /data/chunkserver0  <span class="token number">22</span>/90      Formatting
server-host3  /dev/vdb  /data/chunkserver0  <span class="token number">22</span>/90      Formatting
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u683C\u5F0F\u5316\u5B8C\u6210\u540E\u7684\u8F93\u51FA\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ curveadm <span class="token function">format</span> --status
Get Format Status: <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>

Host          Device    MountPoint          Formatted  Status
----          ------    ----------          ---------  ------
server-host1  /dev/vdb  /data/chunkserver0  <span class="token number">95</span>/90      Done
server-host2  /dev/vdb  /data/chunkserver0  <span class="token number">95</span>/90      Done
server-host3  /dev/vdb  /data/chunkserver0  <span class="token number">95</span>/90      Done
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u90E8\u7F72-curvebs-\u96C6\u7FA4" tabindex="-1"><a class="header-anchor" href="#\u90E8\u7F72-curvebs-\u96C6\u7FA4" aria-hidden="true">#</a> \u90E8\u7F72 CurveBS \u96C6\u7FA4</h2><p>\u9996\u5148\uFF0C\u51C6\u5907\u96C6\u7FA4\u914D\u7F6E\u6587\u4EF6\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">vim</span> topology.yaml
</code></pre></div><p>\u7C98\u8D34\u5982\u4E0B\u914D\u7F6E\u6587\u4EF6\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> curvebs
<span class="token key atrule">global</span><span class="token punctuation">:</span>
  <span class="token key atrule">container_image</span><span class="token punctuation">:</span> opencurvedocker/curvebs<span class="token punctuation">:</span>v1.2
  <span class="token key atrule">log_dir</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>home<span class="token punctuation">}</span>/logs/$<span class="token punctuation">{</span>service_role<span class="token punctuation">}</span>$<span class="token punctuation">{</span>service_replicas_sequence<span class="token punctuation">}</span>
  <span class="token key atrule">data_dir</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>home<span class="token punctuation">}</span>/data/$<span class="token punctuation">{</span>service_role<span class="token punctuation">}</span>$<span class="token punctuation">{</span>service_replicas_sequence<span class="token punctuation">}</span>
  <span class="token key atrule">s3.nos_address</span><span class="token punctuation">:</span> 127.0.0.1
  <span class="token key atrule">s3.snapshot_bucket_name</span><span class="token punctuation">:</span> curve
  <span class="token key atrule">s3.ak</span><span class="token punctuation">:</span> minioadmin
  <span class="token key atrule">s3.sk</span><span class="token punctuation">:</span> minioadmin
  <span class="token key atrule">variable</span><span class="token punctuation">:</span>
    <span class="token key atrule">home</span><span class="token punctuation">:</span> /tmp
    <span class="token key atrule">machine1</span><span class="token punctuation">:</span> server<span class="token punctuation">-</span>host1
    <span class="token key atrule">machine2</span><span class="token punctuation">:</span> server<span class="token punctuation">-</span>host2
    <span class="token key atrule">machine3</span><span class="token punctuation">:</span> server<span class="token punctuation">-</span>host3

<span class="token key atrule">etcd_services</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">listen.ip</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>service_host<span class="token punctuation">}</span>
    <span class="token key atrule">listen.port</span><span class="token punctuation">:</span> <span class="token number">2380</span>
    <span class="token key atrule">listen.client_port</span><span class="token punctuation">:</span> <span class="token number">2379</span>
  <span class="token key atrule">deploy</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>machine1<span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>machine2<span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>machine3<span class="token punctuation">}</span>

<span class="token key atrule">mds_services</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">listen.ip</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>service_host<span class="token punctuation">}</span>
    <span class="token key atrule">listen.port</span><span class="token punctuation">:</span> <span class="token number">6666</span>
    <span class="token key atrule">listen.dummy_port</span><span class="token punctuation">:</span> <span class="token number">6667</span>
  <span class="token key atrule">deploy</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>machine1<span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>machine2<span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>machine3<span class="token punctuation">}</span>

<span class="token key atrule">chunkserver_services</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">listen.ip</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>service_host<span class="token punctuation">}</span>
    <span class="token key atrule">listen.port</span><span class="token punctuation">:</span> 82$<span class="token punctuation">{</span>format_replicas_sequence<span class="token punctuation">}</span> <span class="token comment"># 8200,8201,8202</span>
    <span class="token key atrule">data_dir</span><span class="token punctuation">:</span> /data/chunkserver$<span class="token punctuation">{</span>service_replicas_sequence<span class="token punctuation">}</span> <span class="token comment"># /data/chunkserver0, /data/chunksever1</span>
    <span class="token key atrule">copysets</span><span class="token punctuation">:</span> <span class="token number">100</span>
  <span class="token key atrule">deploy</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>machine1<span class="token punctuation">}</span>
      <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>machine2<span class="token punctuation">}</span>
      <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>machine3<span class="token punctuation">}</span>
      <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>

<span class="token key atrule">snapshotclone_services</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">listen.ip</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>service_host<span class="token punctuation">}</span>
    <span class="token key atrule">listen.port</span><span class="token punctuation">:</span> <span class="token number">5555</span>
    <span class="token key atrule">listen.dummy_port</span><span class="token punctuation">:</span> <span class="token number">8081</span>
    <span class="token key atrule">listen.proxy_port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
  <span class="token key atrule">deploy</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>machine1<span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>machine2<span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>machine3<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6839\u636E\u4E0A\u8FF0\u7684\u96C6\u7FA4\u62D3\u6251\u6587\u4EF6\u521B\u5EFA\u96C6\u7FA4 <code>my-cluster</code>\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code>curveadm cluster <span class="token function">add</span> my-cluster -f topology.yaml
</code></pre></div><p>\u5207\u6362 <code>my-cluster</code> \u96C6\u7FA4\u4E3A\u5F53\u524D\u7BA1\u7406\u96C6\u7FA4\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code>curveadm cluster checkout my-cluster
</code></pre></div><p>\u90E8\u7F72\u96C6\u7FA4\u3002\u5982\u679C\u90E8\u7F72\u6210\u529F\uFF0C\u5C06\u4F1A\u8F93\u51FA\u7C7B\u4F3C <code>Cluster &#39;my-cluster&#39; successfully deployed ^_^.</code> \u5B57\u6837\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ curveadm deploy --skip snapshotclone

<span class="token punctuation">..</span>.
Create Logical Pool: <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
  + <span class="token assign-left variable">host</span><span class="token operator">=</span>server-host1  <span class="token assign-left variable">role</span><span class="token operator">=</span>mds  <span class="token assign-left variable">containerId</span><span class="token operator">=</span>c6fdd71ae678 <span class="token punctuation">[</span><span class="token number">1</span>/1<span class="token punctuation">]</span> <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>

Start Service: <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
  + <span class="token assign-left variable">host</span><span class="token operator">=</span>server-host1  <span class="token assign-left variable">role</span><span class="token operator">=</span>snapshotclone  <span class="token assign-left variable">containerId</span><span class="token operator">=</span>9d3555ba72fa <span class="token punctuation">[</span><span class="token number">1</span>/1<span class="token punctuation">]</span> <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
  + <span class="token assign-left variable">host</span><span class="token operator">=</span>server-host2  <span class="token assign-left variable">role</span><span class="token operator">=</span>snapshotclone  <span class="token assign-left variable">containerId</span><span class="token operator">=</span>e6ae2b23b57e <span class="token punctuation">[</span><span class="token number">1</span>/1<span class="token punctuation">]</span> <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
  + <span class="token assign-left variable">host</span><span class="token operator">=</span>server-host3  <span class="token assign-left variable">role</span><span class="token operator">=</span>snapshotclone  <span class="token assign-left variable">containerId</span><span class="token operator">=</span>f6d3446c7684 <span class="token punctuation">[</span><span class="token number">1</span>/1<span class="token punctuation">]</span> <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>

Balance Leader: <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
  + <span class="token assign-left variable">host</span><span class="token operator">=</span>server-host1  <span class="token assign-left variable">role</span><span class="token operator">=</span>mds  <span class="token assign-left variable">containerId</span><span class="token operator">=</span>c6fdd71ae678 <span class="token punctuation">[</span><span class="token number">1</span>/1<span class="token punctuation">]</span> <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>

Cluster <span class="token string">&#39;my-cluster&#39;</span> successfully deployed ^_^.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u67E5\u770B\u96C6\u7FA4\u72B6\u6001\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ curveadm status
Get Service Status: <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>

cluster name      <span class="token builtin class-name">:</span> my-cluster
cluster kind      <span class="token builtin class-name">:</span> curvebs
cluster mds addr  <span class="token builtin class-name">:</span> <span class="token number">172.16</span>.0.223:6666,172.16.0.224:6666,172.16.0.225:6666
cluster mds leader: <span class="token number">172.16</span>.0.225:6666 / d0a94a7afa14

Id            Role         Host          Replicas  Container Id  Status
--            ----         ----          --------  ------------  ------
5567a1c56ab9  etcd         server-host1  <span class="token number">1</span>/1       f894c5485a26  Up <span class="token number">17</span> seconds
68f9f0e6f108  etcd         server-host2  <span class="token number">1</span>/1       69b09cdbf503  Up <span class="token number">17</span> seconds
a678263898cc  etcd         server-host3  <span class="token number">1</span>/1       2ed141800731  Up <span class="token number">17</span> seconds
4dcbdd08e2cd  mds          server-host1  <span class="token number">1</span>/1       76d62ff0eb25  Up <span class="token number">17</span> seconds
8ef1755b0a10  mds          server-host2  <span class="token number">1</span>/1       d8d838258a6f  Up <span class="token number">17</span> seconds
f3599044c6b5  mds          server-host3  <span class="token number">1</span>/1       d63ae8502856  Up <span class="token number">17</span> seconds
9f1d43bc5b03  chunkserver  server-host1  <span class="token number">1</span>/1       39751a4f49d5  Up <span class="token number">16</span> seconds
3fb8fd7b37c1  chunkserver  server-host2  <span class="token number">1</span>/1       0f55a19ed44b  Up <span class="token number">16</span> seconds
c4da555952e3  chunkserver  server-host3  <span class="token number">1</span>/1       9411274d2c97  Up <span class="token number">16</span> seconds
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u90E8\u7F72-curvebs-\u5BA2\u6237\u7AEF" tabindex="-1"><a class="header-anchor" href="#\u90E8\u7F72-curvebs-\u5BA2\u6237\u7AEF" aria-hidden="true">#</a> \u90E8\u7F72 CurveBS \u5BA2\u6237\u7AEF</h2><p>\u5728 Curve \u4E2D\u63A7\u673A\u4E0A\u7F16\u8F91\u5BA2\u6237\u7AEF\u914D\u7F6E\u6587\u4EF6\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">vim</span> client.yaml
</code></pre></div><p>\u6CE8\u610F\uFF0C\u8FD9\u91CC\u7684 <code>mds.listen.addr</code> \u8BF7\u586B\u5199\u4E0A\u4E00\u6B65\u96C6\u7FA4\u72B6\u6001\u4E2D\u8F93\u51FA\u7684 <code>cluster mds addr</code>\uFF1A</p><div class="language-yaml ext-yml"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> curvebs
<span class="token key atrule">container_image</span><span class="token punctuation">:</span> opencurvedocker/curvebs<span class="token punctuation">:</span>v1.2
<span class="token key atrule">mds.listen.addr</span><span class="token punctuation">:</span> 172.16.0.223<span class="token punctuation">:</span><span class="token number">6666</span><span class="token punctuation">,</span>172.16.0.224<span class="token punctuation">:</span><span class="token number">6666</span><span class="token punctuation">,</span>172.16.0.225<span class="token punctuation">:</span><span class="token number">6666</span>
<span class="token key atrule">log_dir</span><span class="token punctuation">:</span> /root/curvebs/logs/client
</code></pre></div><hr><h2 id="\u51C6\u5907\u5206\u5E03\u5F0F\u6587\u4EF6\u7CFB\u7EDF" tabindex="-1"><a class="header-anchor" href="#\u51C6\u5907\u5206\u5E03\u5F0F\u6587\u4EF6\u7CFB\u7EDF" aria-hidden="true">#</a> \u51C6\u5907\u5206\u5E03\u5F0F\u6587\u4EF6\u7CFB\u7EDF</h2>`,43),Q=n("\u63A5\u4E0B\u6765\uFF0C\u5C06\u5728\u4E24\u53F0\u8FD0\u884C PolarDB \u8BA1\u7B97\u8282\u70B9\u7684 ECS \u4E0A\u5206\u522B\u90E8\u7F72 PolarDB \u7684\u4E3B\u8282\u70B9\u548C\u53EA\u8BFB\u8282\u70B9\u3002\u4F5C\u4E3A\u524D\u63D0\uFF0C\u9700\u8981\u8BA9\u8FD9\u4E24\u4E2A\u8282\u70B9\u80FD\u591F\u5171\u4EAB CurveBS \u5757\u8BBE\u5907\uFF0C\u5E76\u5728\u5757\u8BBE\u5907\u4E0A "),V=n("\u683C\u5F0F\u5316\u5E76\u6302\u8F7D PFS"),G=n("\u3002");function M(p,W){const o=t("Badge"),l=t("ArticleInfo"),e=t("ExternalLinkIcon"),c=t("RouterLink");return u(),r("div",null,[s("h1",b,[h,g,s("a",f,[a(o,{type:"tip",text:"\u89C6\u9891",vertical:"top"})])]),a(l,{frontmatter:p.$frontmatter},null,8,["frontmatter"]),s("p",null,[s("a",_,[y,a(e)]),S]),x,$,s("p",null,[C,s("a",P,[B,a(e)]),O]),K,D,I,s("p",null,[F,s("a",L,[U,a(e)]),w]),s("ol",null,[s("li",null,[q,s("a",E,[R,a(e)]),A]),H]),N,s("p",null,[Q,a(c,{to:"/deploying/fs-pfs-curve.html"},{default:d(()=>[V]),_:1}),G])])}var X=i(m,[["render",M],["__file","storage-curvebs.html.vue"]]);export{X as default};
