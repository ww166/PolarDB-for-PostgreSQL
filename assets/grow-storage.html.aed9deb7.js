import{_ as l,o as u,c as d,b as a,a as s,w as e,d as n,e as i,r as t}from"./app.f10a4800.js";var k="/PolarDB-for-PostgreSQL/assets/essd-storage-grow.11277a20.png",m="/PolarDB-for-PostgreSQL/assets/essd-storage-online-grow.bce55f20.png",b="/PolarDB-for-PostgreSQL/assets/essd-storage-grow-complete.f9a772d3.png";const g={},_=s("h1",{id:"polardb-pg-\u5B58\u50A8\u52A8\u6001\u6269\u5BB9",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#polardb-pg-\u5B58\u50A8\u52A8\u6001\u6269\u5BB9","aria-hidden":"true"},"#"),n(" PolarDB PG \u5B58\u50A8\u52A8\u6001\u6269\u5BB9")],-1),h=s("p",null,"\u5728\u4F7F\u7528\u6570\u636E\u5E93\u65F6\uFF0C\u968F\u7740\u6570\u636E\u91CF\u7684\u9010\u6E10\u589E\u5927\uFF0C\u4E0D\u53EF\u907F\u514D\u9700\u8981\u5BF9\u6570\u636E\u5E93\u6240\u4F7F\u7528\u7684\u5B58\u50A8\u7A7A\u95F4\u8FDB\u884C\u6269\u5BB9\u3002\u7531\u4E8E PolarDB for PostgreSQL \u57FA\u4E8E\u5171\u4EAB\u5B58\u50A8\u4E0E\u5206\u5E03\u5F0F\u6587\u4EF6\u7CFB\u7EDF PFS \u7684\u67B6\u6784\u8BBE\u8BA1\uFF0C\u4E0E\u5B89\u88C5\u90E8\u7F72\u65F6\u7C7B\u4F3C\uFF0C\u5728\u6269\u5BB9\u65F6\uFF0C\u9700\u8981\u5728\u4EE5\u4E0B\u4E09\u4E2A\u5C42\u9762\u5206\u522B\u8FDB\u884C\u64CD\u4F5C\uFF1A",-1),S={class:"table-of-contents"},f=n("\u5757\u5B58\u50A8\u5C42\u6269\u5BB9"),v=n("\u6587\u4EF6\u7CFB\u7EDF\u5C42\u6269\u5BB9"),P=n("\u6570\u636E\u5E93\u5B9E\u4F8B\u5C42\u6269\u5BB9"),E=s("p",null,"\u672C\u6587\u5C06\u6307\u5BFC\u60A8\u5206\u522B\u5728\u4EE5\u4E0A\u4E09\u4E2A\u5C42\u9762\u4E0A\u5206\u522B\u5B8C\u6210\u6269\u5BB9\u64CD\u4F5C\uFF0C\u4EE5\u5B9E\u73B0\u4E0D\u505C\u6B62\u6570\u636E\u5E93\u5B9E\u4F8B\u7684\u52A8\u6001\u6269\u5BB9\u3002",-1),x=s("h2",{id:"\u5757\u5B58\u50A8\u5C42\u6269\u5BB9",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#\u5757\u5B58\u50A8\u5C42\u6269\u5BB9","aria-hidden":"true"},"#"),n(" \u5757\u5B58\u50A8\u5C42\u6269\u5BB9")],-1),B=n("\u9996\u5148\u9700\u8981\u8FDB\u884C\u7684\u662F\u5757\u5B58\u50A8\u5C42\u9762\u4E0A\u7684\u6269\u5BB9\u3002\u4E0D\u7BA1\u4F7F\u7528\u54EA\u79CD\u7C7B\u578B\u7684\u5171\u4EAB\u5B58\u50A8\uFF0C\u5B58\u50A8\u5C42\u9762\u6269\u5BB9\u6700\u7EC8\u9700\u8981\u8FBE\u6210\u7684\u76EE\u7684\u662F\uFF1A\u5728\u80FD\u591F\u8BBF\u95EE\u5171\u4EAB\u5B58\u50A8\u7684\u4E3B\u673A\u4E0A\u8FD0\u884C "),D=s("code",null,"lsblk",-1),w=n(" \u547D\u4EE4\uFF0C\u663E\u793A\u5B58\u50A8\u5757\u8BBE\u5907\u7684\u7269\u7406\u7A7A\u95F4\u53D8\u5927\u3002\u7531\u4E8E\u4E0D\u540C\u7C7B\u578B\u7684\u5171\u4EAB\u5B58\u50A8\u6709\u4E0D\u540C\u7684\u6269\u5BB9\u65B9\u5F0F\uFF0C\u672C\u6587\u4EE5 "),G=n("\u963F\u91CC\u4E91 ECS + ESSD \u4E91\u76D8\u5171\u4EAB\u5B58\u50A8"),R=n(" \u4E3A\u4F8B\u6F14\u793A\u5982\u4F55\u8FDB\u884C\u5B58\u50A8\u5C42\u9762\u7684\u6269\u5BB9\u3002"),N=i(`<p>\u53E6\u5916\uFF0C\u4E3A\u4FDD\u8BC1\u540E\u7EED\u6269\u5BB9\u6B65\u9AA4\u7684\u6210\u529F\uFF0C\u8BF7\u4EE5 10GB \u4E3A\u5355\u4F4D\u8FDB\u884C\u6269\u5BB9\u3002</p><p>\u672C\u793A\u4F8B\u4E2D\uFF0C\u5728\u6269\u5BB9\u4E4B\u524D\uFF0C\u5DF2\u6709\u4E00\u4E2A 20GB \u7684 ESSD \u4E91\u76D8\u591A\u91CD\u6302\u8F7D\u5728\u4E24\u53F0 ECS \u4E0A\u3002\u5728\u8FD9\u4E24\u53F0 ECS \u4E0A\u8FD0\u884C <code>lsblk</code>\uFF0C\u53EF\u4EE5\u770B\u5230 ESSD \u4E91\u76D8\u5171\u4EAB\u5B58\u50A8\u5BF9\u5E94\u7684\u5757\u8BBE\u5907 <code>nvme1n1</code> \u76EE\u524D\u7684\u7269\u7406\u7A7A\u95F4\u4E3A 20GB\u3002</p><div class="language-bash ext-sh"><pre class="language-bash"><code>$ lsblk
NAME        MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
nvme0n1     <span class="token number">259</span>:0    <span class="token number">0</span>  40G  <span class="token number">0</span> disk
\u2514\u2500nvme0n1p1 <span class="token number">259</span>:1    <span class="token number">0</span>  40G  <span class="token number">0</span> part /etc/hosts
nvme1n1     <span class="token number">259</span>:2    <span class="token number">0</span>  20G  <span class="token number">0</span> disk
</code></pre></div><p>\u63A5\u4E0B\u6765\u5BF9\u8FD9\u5757 ESSD \u4E91\u76D8\u8FDB\u884C\u6269\u5BB9\u3002\u5728\u963F\u91CC\u4E91 ESSD \u4E91\u76D8\u7684\u7BA1\u7406\u9875\u9762\u4E0A\uFF0C\u70B9\u51FB <strong>\u4E91\u76D8\u6269\u5BB9</strong>\uFF1A</p><p><img src="`+k+'" alt="essd-storage-grow"></p><p>\u8FDB\u5165\u5230\u4E91\u76D8\u6269\u5BB9\u754C\u9762\u4EE5\u540E\uFF0C\u53EF\u4EE5\u770B\u5230\u8BE5\u4E91\u76D8\u5DF2\u88AB\u4E24\u53F0 ECS \u5B9E\u4F8B\u591A\u91CD\u6302\u8F7D\u3002\u586B\u5199\u6269\u5BB9\u540E\u7684\u5BB9\u91CF\uFF0C\u7136\u540E\u70B9\u51FB\u786E\u8BA4\u6269\u5BB9\uFF0C\u628A 20GB \u7684\u4E91\u76D8\u6269\u5BB9\u4E3A 40GB\uFF1A</p><p><img src="'+m+'" alt="essd-storage-online-grow"></p><p>\u6269\u5BB9\u6210\u529F\u540E\uFF0C\u5C06\u4F1A\u770B\u5230\u5982\u4E0B\u63D0\u793A\uFF1A</p><p><img src="'+b+`" alt="essd-storage-grow-complete"></p><p>\u6B64\u65F6\uFF0C\u4E24\u53F0 ECS \u4E0A\u8FD0\u884C <code>lsblk</code>\uFF0C\u53EF\u4EE5\u770B\u5230 ESSD \u5BF9\u5E94\u5757\u8BBE\u5907 <code>nvme1n1</code> \u7684\u7269\u7406\u7A7A\u95F4\u5DF2\u7ECF\u53D8\u4E3A 40GB\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code>$ lsblk
NAME        MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
nvme0n1     <span class="token number">259</span>:0    <span class="token number">0</span>  40G  <span class="token number">0</span> disk
\u2514\u2500nvme0n1p1 <span class="token number">259</span>:1    <span class="token number">0</span>  40G  <span class="token number">0</span> part /etc/hosts
nvme1n1     <span class="token number">259</span>:2    <span class="token number">0</span>  40G  <span class="token number">0</span> disk
</code></pre></div><p>\u81F3\u6B64\uFF0C\u5757\u5B58\u50A8\u5C42\u9762\u7684\u6269\u5BB9\u5C31\u5B8C\u6210\u4E86\u3002</p><h2 id="\u6587\u4EF6\u7CFB\u7EDF\u5C42\u6269\u5BB9" tabindex="-1"><a class="header-anchor" href="#\u6587\u4EF6\u7CFB\u7EDF\u5C42\u6269\u5BB9" aria-hidden="true">#</a> \u6587\u4EF6\u7CFB\u7EDF\u5C42\u6269\u5BB9</h2><p>\u5728\u7269\u7406\u5757\u8BBE\u5907\u5B8C\u6210\u6269\u5BB9\u4EE5\u540E\uFF0C\u63A5\u4E0B\u6765\u9700\u8981\u4F7F\u7528 PFS \u6587\u4EF6\u7CFB\u7EDF\u63D0\u4F9B\u7684\u5DE5\u5177\uFF0C\u5BF9\u5757\u8BBE\u5907\u4E0A\u6269\u5927\u540E\u7684\u7269\u7406\u7A7A\u95F4\u8FDB\u884C\u683C\u5F0F\u5316\uFF0C\u4EE5\u5B8C\u6210\u6587\u4EF6\u7CFB\u7EDF\u5C42\u9762\u7684\u6269\u5BB9\u3002</p><p>\u5728\u80FD\u591F\u8BBF\u95EE\u5171\u4EAB\u5B58\u50A8\u7684 <strong>\u4EFB\u610F\u4E00\u53F0\u4E3B\u673A\u4E0A</strong> \u8FD0\u884C PFS \u7684 <code>growfs</code> \u547D\u4EE4\uFF0C\u5176\u4E2D\uFF1A</p><ul><li><code>-o</code> \u8868\u793A\u5171\u4EAB\u5B58\u50A8\u6269\u5BB9\u524D\u7684\u7A7A\u95F4\uFF08\u4EE5 10GB \u4E3A\u5355\u4F4D\uFF09</li><li><code>-n</code> \u8868\u793A\u5171\u4EAB\u5B58\u50A8\u6269\u5BB9\u540E\u7684\u7A7A\u95F4\uFF08\u4EE5 10GB \u4E3A\u5355\u4F4D\uFF09</li></ul><p>\u672C\u4F8B\u5C06\u5171\u4EAB\u5B58\u50A8\u4ECE 20GB \u6269\u5BB9\u81F3 40GB\uFF0C\u6240\u4EE5\u53C2\u6570\u5206\u522B\u586B\u5199 <code>2</code> \u548C <code>4</code>\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code>$ <span class="token function">sudo</span> pfs -C disk growfs -o <span class="token number">2</span> -n <span class="token number">4</span> nvme1n1

<span class="token punctuation">..</span>.

Init chunk <span class="token number">2</span>
                metaset        <span class="token number">2</span>/1: sectbda      0x500001000, npage       <span class="token number">80</span>, objsize  <span class="token number">128</span>, nobj <span class="token number">2560</span>, oid range <span class="token punctuation">[</span>    <span class="token number">2000</span>,     2a00<span class="token punctuation">)</span>
                metaset        <span class="token number">2</span>/2: sectbda      0x500051000, npage       <span class="token number">64</span>, objsize  <span class="token number">128</span>, nobj <span class="token number">2048</span>, oid range <span class="token punctuation">[</span>    <span class="token number">1000</span>,     <span class="token number">1800</span><span class="token punctuation">)</span>
                metaset        <span class="token number">2</span>/3: sectbda      0x500091000, npage       <span class="token number">64</span>, objsize  <span class="token number">128</span>, nobj <span class="token number">2048</span>, oid range <span class="token punctuation">[</span>    <span class="token number">1000</span>,     <span class="token number">1800</span><span class="token punctuation">)</span>

Init chunk <span class="token number">3</span>
                metaset        <span class="token number">3</span>/1: sectbda      0x780001000, npage       <span class="token number">80</span>, objsize  <span class="token number">128</span>, nobj <span class="token number">2560</span>, oid range <span class="token punctuation">[</span>    <span class="token number">3000</span>,     3a00<span class="token punctuation">)</span>
                metaset        <span class="token number">3</span>/2: sectbda      0x780051000, npage       <span class="token number">64</span>, objsize  <span class="token number">128</span>, nobj <span class="token number">2048</span>, oid range <span class="token punctuation">[</span>    <span class="token number">1800</span>,     <span class="token number">2000</span><span class="token punctuation">)</span>
                metaset        <span class="token number">3</span>/3: sectbda      0x780091000, npage       <span class="token number">64</span>, objsize  <span class="token number">128</span>, nobj <span class="token number">2048</span>, oid range <span class="token punctuation">[</span>    <span class="token number">1800</span>,     <span class="token number">2000</span><span class="token punctuation">)</span>

pfs growfs succeeds<span class="token operator">!</span>
</code></pre></div><p>\u5982\u679C\u770B\u5230\u4E0A\u8FF0\u8F93\u51FA\uFF0C\u8BF4\u660E\u6587\u4EF6\u7CFB\u7EDF\u5C42\u9762\u7684\u6269\u5BB9\u5DF2\u7ECF\u5B8C\u6210\u3002</p><h2 id="\u6570\u636E\u5E93\u5B9E\u4F8B\u5C42\u6269\u5BB9" tabindex="-1"><a class="header-anchor" href="#\u6570\u636E\u5E93\u5B9E\u4F8B\u5C42\u6269\u5BB9" aria-hidden="true">#</a> \u6570\u636E\u5E93\u5B9E\u4F8B\u5C42\u6269\u5BB9</h2><p>\u6700\u540E\uFF0C\u5728\u6570\u636E\u5E93\u5B9E\u4F8B\u5C42\uFF0C\u6269\u5BB9\u9700\u8981\u505A\u7684\u5DE5\u4F5C\u662F\u6267\u884C SQL \u51FD\u6570\u6765\u901A\u77E5\u6BCF\u4E2A\u5B9E\u4F8B\u4E0A\u5DF2\u7ECF\u6302\u8F7D\u5230\u5171\u4EAB\u5B58\u50A8\u7684 PFSD\uFF08PFS Daemon\uFF09\u5B88\u62A4\u8FDB\u7A0B\uFF0C\u544A\u77E5\u5171\u4EAB\u5B58\u50A8\u4E0A\u7684\u65B0\u7A7A\u95F4\u5DF2\u7ECF\u53EF\u4EE5\u88AB\u4F7F\u7528\u4E86\u3002\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u6570\u636E\u5E93\u5B9E\u4F8B\u96C6\u7FA4\u4E2D\u7684 <strong>\u6240\u6709</strong> PFSD \u90FD\u9700\u8981\u88AB\u901A\u77E5\u5230\uFF0C\u5E76\u4E14\u9700\u8981 <strong>\u5148\u901A\u77E5\u6240\u6709 RO \u8282\u70B9\u4E0A\u7684 PFSD\uFF0C\u6700\u540E\u901A\u77E5 RW \u8282\u70B9\u4E0A\u7684 PFSD</strong>\u3002\u8FD9\u610F\u5473\u7740\u6211\u4EEC\u9700\u8981\u5728 <strong>\u6BCF\u4E00\u4E2A</strong> PolarDB for PostgreSQL \u8282\u70B9\u4E0A\u6267\u884C\u4E00\u6B21\u901A\u77E5 PFSD \u7684 SQL \u51FD\u6570\uFF0C\u5E76\u4E14 <strong>RO \u8282\u70B9\u5728\u5148\uFF0CRW \u8282\u70B9\u5728\u540E</strong>\u3002</p><p>\u6570\u636E\u5E93\u5B9E\u4F8B\u5C42\u901A\u77E5 PFSD \u7684\u6269\u5BB9\u51FD\u6570\u5B9E\u73B0\u5728 PolarDB for PostgreSQL \u7684 <code>polar_vfs</code> \u63D2\u4EF6\u4E2D\uFF0C\u6240\u4EE5\u9996\u5148\u9700\u8981\u5728 <strong>RW \u8282\u70B9</strong> \u4E0A\u52A0\u8F7D <code>polar_vfs</code> \u63D2\u4EF6\u3002\u5728\u52A0\u8F7D\u63D2\u4EF6\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u4F1A\u5728 RW \u8282\u70B9\u548C\u6240\u6709 RO \u8282\u70B9\u4E0A\u6CE8\u518C\u597D <code>polar_vfs_disk_expansion</code> \u8FD9\u4E2A SQL \u51FD\u6570\u3002</p><div class="language-sql ext-sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> EXTENSION <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> polar_vfs<span class="token punctuation">;</span>
</code></pre></div><p>\u63A5\u4E0B\u6765\uFF0C<strong>\u4F9D\u6B21</strong> \u5728\u6240\u6709\u7684 RO \u8282\u70B9\u4E0A\uFF0C\u518D\u5230 RW \u8282\u70B9\u4E0A <strong>\u5206\u522B</strong> \u6267\u884C\u8FD9\u4E2A SQL \u51FD\u6570\u3002\u5176\u4E2D\u51FD\u6570\u7684\u53C2\u6570\u540D\u4E3A\u5757\u8BBE\u5907\u540D\uFF1A</p><div class="language-sql ext-sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> polar_vfs_disk_expansion<span class="token punctuation">(</span><span class="token string">&#39;nvme1n1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>\u6267\u884C\u5B8C\u6BD5\u540E\uFF0C\u6570\u636E\u5E93\u5B9E\u4F8B\u5C42\u9762\u7684\u6269\u5BB9\u4E5F\u5C31\u5B8C\u6210\u4E86\u3002\u6B64\u65F6\uFF0C\u65B0\u7684\u5B58\u50A8\u7A7A\u95F4\u5DF2\u7ECF\u80FD\u591F\u88AB\u6570\u636E\u5E93\u4F7F\u7528\u4E86\u3002</p>`,26);function I(p,L){const c=t("ArticleInfo"),o=t("router-link"),r=t("RouterLink");return u(),d("div",null,[_,a(c,{frontmatter:p.$frontmatter},null,8,["frontmatter"]),h,s("nav",S,[s("ul",null,[s("li",null,[a(o,{to:"#\u5757\u5B58\u50A8\u5C42\u6269\u5BB9"},{default:e(()=>[f]),_:1})]),s("li",null,[a(o,{to:"#\u6587\u4EF6\u7CFB\u7EDF\u5C42\u6269\u5BB9"},{default:e(()=>[v]),_:1})]),s("li",null,[a(o,{to:"#\u6570\u636E\u5E93\u5B9E\u4F8B\u5C42\u6269\u5BB9"},{default:e(()=>[P]),_:1})])])]),E,x,s("p",null,[B,D,w,a(r,{to:"/deploying/storage-aliyun-essd.html"},{default:e(()=>[G]),_:1}),R]),N])}var O=l(g,[["render",I],["__file","grow-storage.html.vue"]]);export{O as default};
