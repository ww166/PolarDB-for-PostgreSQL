<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.49">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/PolarDB-for-PostgreSQL/favicon.ico"><title>PolarDB PG 备份恢复 | PolarDB for PostgreSQL</title><meta name="description" content="A cloud-native database developed by Alibaba Cloud">
    <link rel="modulepreload" href="/PolarDB-for-PostgreSQL/assets/app.f10a4800.js"><link rel="modulepreload" href="/PolarDB-for-PostgreSQL/assets/backup-and-restore.html.574a7024.js"><link rel="modulepreload" href="/PolarDB-for-PostgreSQL/assets/backup-and-restore.html.6cc6f4ce.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/index.html.51b1f6a9.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/code-of-conduct.html.0ffca9c3.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/coding-style.html.865e17f3.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/contributing-polardb-docs.html.7b3ea452.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/contributing-polardb-kernel.html.6b54c6d2.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/db-localfs.html.48484cfa.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/db-pfs.html.9bf1c684.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/deploy-official.html.cf4d1d8a.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/deploy-stack.html.89a926d2.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/deploy.html.10b3bb91.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/fs-pfs-curve.html.90b7d490.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/fs-pfs.html.d384be4e.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/introduction.html.176cb4df.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/quick-start.html.12fcd4f1.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/storage-aliyun-essd.html.4f2d2096.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/storage-ceph.html.4a85fe73.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/storage-curvebs.html.110257d4.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/storage-nbd.html.a1c61ed8.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/customize-dev-env.html.5cc1500a.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/dev-on-docker.html.94a1140b.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/tpch-on-px.html.f187e377.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/grow-storage.html.57d013d8.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/tpcc-test.html.c740c78d.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/index.html.02530182.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/analyze.html.aac18d2e.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/arch-overview.html.94b25fb7.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/buffer-management.html.2c310992.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/ddl-synchronization.html.cd3edee2.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/logindex.html.f06bd1be.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/index.html.7857d29f.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/code-of-conduct.html.7b5a3b04.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/coding-style.html.a3e30cfb.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/contributing-polardb-docs.html.9edb5ca2.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/contributing-polardb-kernel.html.1c0ab542.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/db-localfs.html.9aa3d96d.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/db-pfs.html.83a4eea2.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/deploy-official.html.9ba17af4.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/deploy-stack.html.ba7f96bc.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/deploy.html.5460bc5a.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/fs-pfs-curve.html.04c85ffd.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/fs-pfs.html.7f41dd98.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/introduction.html.3ab75f9f.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/quick-start.html.094414a3.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/storage-aliyun-essd.html.c499b34b.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/storage-ceph.html.abe714e2.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/storage-curvebs.html.26afdf3f.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/storage-nbd.html.55f20d32.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/customize-dev-env.html.4c1a11ab.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/dev-on-docker.html.64197439.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/tpch-on-px.html.856852e1.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/backup-and-restore.html.8ea40659.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/grow-storage.html.b164fc47.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/tpcc-test.html.d7fcda11.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/index.html.a5a40c8a.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/analyze.html.6e1217d4.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/arch-overview.html.a73e302a.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/buffer-management.html.65ae6315.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/ddl-synchronization.html.c237c6b2.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/logindex.html.556f1ff0.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/404.html.7d858b3d.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/index.html.821f8ac3.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/code-of-conduct.html.f40f7ce0.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/coding-style.html.37077a5d.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/contributing-polardb-docs.html.0dab70f9.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/contributing-polardb-kernel.html.57cec2cb.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/db-localfs.html.6214eec0.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/db-pfs.html.353b2673.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/deploy-official.html.9f2bb758.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/deploy-stack.html.1a7c01c8.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/deploy.html.936c40a8.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/fs-pfs-curve.html.4c6d1c5a.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/fs-pfs.html.224b1aa8.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/introduction.html.ea55e8d4.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/quick-start.html.79c094b8.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/storage-aliyun-essd.html.68ed0943.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/storage-ceph.html.014a574f.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/storage-curvebs.html.5c604f13.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/storage-nbd.html.2c332c9b.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/customize-dev-env.html.484c1ecc.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/dev-on-docker.html.de0bfe1f.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/tpch-on-px.html.1a5694de.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/grow-storage.html.aed9deb7.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/tpcc-test.html.5c388caf.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/index.html.24b5b6f0.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/analyze.html.dd8a5baa.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/arch-overview.html.5867d298.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/buffer-management.html.93cdf840.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/ddl-synchronization.html.fdf73ac8.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/logindex.html.cf05cc2e.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/index.html.d9a80384.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/code-of-conduct.html.90361c3c.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/coding-style.html.3e38ecb2.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/contributing-polardb-docs.html.eb59d898.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/contributing-polardb-kernel.html.ac270d39.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/db-localfs.html.d41be5f5.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/db-pfs.html.e125e206.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/deploy-official.html.cb885013.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/deploy-stack.html.c4d2adfb.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/deploy.html.1e64f065.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/fs-pfs-curve.html.53d0de50.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/fs-pfs.html.88c79e34.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/introduction.html.7d9fd3f0.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/quick-start.html.b5f84186.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/storage-aliyun-essd.html.b3592855.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/storage-ceph.html.42aea985.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/storage-curvebs.html.2af65eb2.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/storage-nbd.html.c67feaa5.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/customize-dev-env.html.ed7b3525.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/dev-on-docker.html.1b00d4e5.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/tpch-on-px.html.6452266c.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/backup-and-restore.html.915207e6.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/grow-storage.html.11e1e70c.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/tpcc-test.html.9d880dc4.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/index.html.4ed380db.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/analyze.html.2be626cf.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/arch-overview.html.6ccc22d3.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/buffer-management.html.1f9c8323.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/ddl-synchronization.html.89cba96c.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/logindex.html.4ece16b8.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/404.html.904a7c8a.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/404.db616541.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/Layout.59d7e6f0.js"><link rel="prefetch" href="/PolarDB-for-PostgreSQL/assets/ArticleInfo.6499ed5f.js">
    <link rel="stylesheet" href="/PolarDB-for-PostgreSQL/assets/style.f33fb32a.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/PolarDB-for-PostgreSQL/" class=""><img class="logo" src="/PolarDB-for-PostgreSQL/images/polardb.png" alt="PolarDB for PostgreSQL"><span class="site-name can-hide">PolarDB for PostgreSQL</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Deployment"><span class="title">Deployment</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Deployment"><span class="title">Deployment</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/deploying/introduction.html" class="" aria-label="架构简介"><!--[--><!--]--> 架构简介 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/deploying/quick-start.html" class="" aria-label="快速部署"><!--[--><!--]--> 快速部署 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/deploying/deploy.html" class="" aria-label="进阶部署"><!--[--><!--]--> 进阶部署 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Preparation of Storage Device</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/deploying/storage-aliyun-essd.html" class="" aria-label="阿里云 ECS + ESSD 云盘存储"><!--[--><!--]--> 阿里云 ECS + ESSD 云盘存储 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/deploying/storage-curvebs.html" class="" aria-label="CurveBS 共享存储"><!--[--><!--]--> CurveBS 共享存储 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/deploying/storage-ceph.html" class="" aria-label="Ceph 共享存储"><!--[--><!--]--> Ceph 共享存储 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/deploying/storage-nbd.html" class="" aria-label="NBD 共享存储"><!--[--><!--]--> NBD 共享存储 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Preparation of File System</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/deploying/fs-pfs.html" class="" aria-label="格式化并挂载 PFS"><!--[--><!--]--> 格式化并挂载 PFS <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/deploying/fs-pfs-curve.html" class="" aria-label="格式化并挂载 PFS for CurveBS"><!--[--><!--]--> 格式化并挂载 PFS for CurveBS <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Building PolarDB Kernel</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/deploying/db-localfs.html" class="" aria-label="编译部署：基于单机文件系统"><!--[--><!--]--> 编译部署：基于单机文件系统 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/deploying/db-pfs.html" class="" aria-label="编译部署：基于 PFS 文件系统"><!--[--><!--]--> 编译部署：基于 PFS 文件系统 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>More about Deployment</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/deploying/deploy-stack.html" class="" aria-label="基于 PolarDB Stack 共享存储"><!--[--><!--]--> 基于 PolarDB Stack 共享存储 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/deploying/deploy-official.html" class="" aria-label="阿里云官网购买实例"><!--[--><!--]--> 阿里云官网购买实例 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Ops"><span class="title">Ops</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Ops"><span class="title">Ops</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Daily Ops</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a aria-current="page" href="/PolarDB-for-PostgreSQL/operation/backup-and-restore.html" class="router-link-active router-link-exact-active router-link-active" aria-label="PolarDB PG 备份恢复"><!--[--><!--]--> PolarDB PG 备份恢复 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/operation/grow-storage.html" class="" aria-label="PolarDB PG 存储动态扩容"><!--[--><!--]--> PolarDB PG 存储动态扩容 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Benchmarks</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/operation/tpcc-test.html" class="" aria-label="PolarDB PG TPC-C 测试"><!--[--><!--]--> PolarDB PG TPC-C 测试 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Features"><span class="title">Features</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Features"><span class="title">Features</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>HTAP</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/features/tpch-on-px.html" class="" aria-label="利用 PolarDB HTAP 加速 TPC-H"><!--[--><!--]--> 利用 PolarDB HTAP 加速 TPC-H <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Theory"><span class="title">Theory</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Theory"><span class="title">Theory</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>PolarDB for PostgreSQL</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/theory/arch-overview.html" class="" aria-label="Overview"><!--[--><!--]--> Overview <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/theory/buffer-management.html" class="" aria-label="Buffer Management"><!--[--><!--]--> Buffer Management <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/theory/ddl-synchronization.html" class="" aria-label="DDL Synchronization"><!--[--><!--]--> DDL Synchronization <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/theory/logindex.html" class="" aria-label="LogIndex"><!--[--><!--]--> LogIndex <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>PostgreSQL</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/theory/analyze.html" class="" aria-label="Code Analysis of ANALYZE"><!--[--><!--]--> Code Analysis of ANALYZE <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Dev"><span class="title">Dev</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Dev"><span class="title">Dev</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/development/dev-on-docker.html" class="" aria-label="Development on Docker"><!--[--><!--]--> Development on Docker <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/development/customize-dev-env.html" class="" aria-label="Customize Development Environment"><!--[--><!--]--> Customize Development Environment <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Contributing"><span class="title">Contributing</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Contributing"><span class="title">Contributing</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/contributing/code-of-conduct.html" class="" aria-label="Code of Conduct"><!--[--><!--]--> Code of Conduct <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/contributing/contributing-polardb-docs.html" class="" aria-label="Contributing Docs"><!--[--><!--]--> Contributing Docs <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/contributing/contributing-polardb-kernel.html" class="" aria-label="Contributing Code"><!--[--><!--]--> Contributing Code <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/contributing/coding-style.html" class="" aria-label="Coding Style"><!--[--><!--]--> Coding Style <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/PolarDB-for-PostgreSQL/operation/backup-and-restore.html" class="router-link-active router-link-exact-active router-link-active" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/zh/operation/backup-and-restore.html" class="" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/ApsaraDB/PolarDB-for-PostgreSQL" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Deployment"><span class="title">Deployment</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Deployment"><span class="title">Deployment</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/deploying/introduction.html" class="" aria-label="架构简介"><!--[--><!--]--> 架构简介 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/deploying/quick-start.html" class="" aria-label="快速部署"><!--[--><!--]--> 快速部署 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/deploying/deploy.html" class="" aria-label="进阶部署"><!--[--><!--]--> 进阶部署 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Preparation of Storage Device</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/deploying/storage-aliyun-essd.html" class="" aria-label="阿里云 ECS + ESSD 云盘存储"><!--[--><!--]--> 阿里云 ECS + ESSD 云盘存储 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/deploying/storage-curvebs.html" class="" aria-label="CurveBS 共享存储"><!--[--><!--]--> CurveBS 共享存储 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/deploying/storage-ceph.html" class="" aria-label="Ceph 共享存储"><!--[--><!--]--> Ceph 共享存储 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/deploying/storage-nbd.html" class="" aria-label="NBD 共享存储"><!--[--><!--]--> NBD 共享存储 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Preparation of File System</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/deploying/fs-pfs.html" class="" aria-label="格式化并挂载 PFS"><!--[--><!--]--> 格式化并挂载 PFS <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/deploying/fs-pfs-curve.html" class="" aria-label="格式化并挂载 PFS for CurveBS"><!--[--><!--]--> 格式化并挂载 PFS for CurveBS <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Building PolarDB Kernel</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/deploying/db-localfs.html" class="" aria-label="编译部署：基于单机文件系统"><!--[--><!--]--> 编译部署：基于单机文件系统 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/deploying/db-pfs.html" class="" aria-label="编译部署：基于 PFS 文件系统"><!--[--><!--]--> 编译部署：基于 PFS 文件系统 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>More about Deployment</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/deploying/deploy-stack.html" class="" aria-label="基于 PolarDB Stack 共享存储"><!--[--><!--]--> 基于 PolarDB Stack 共享存储 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/deploying/deploy-official.html" class="" aria-label="阿里云官网购买实例"><!--[--><!--]--> 阿里云官网购买实例 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Ops"><span class="title">Ops</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Ops"><span class="title">Ops</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Daily Ops</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a aria-current="page" href="/PolarDB-for-PostgreSQL/operation/backup-and-restore.html" class="router-link-active router-link-exact-active router-link-active" aria-label="PolarDB PG 备份恢复"><!--[--><!--]--> PolarDB PG 备份恢复 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/operation/grow-storage.html" class="" aria-label="PolarDB PG 存储动态扩容"><!--[--><!--]--> PolarDB PG 存储动态扩容 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Benchmarks</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/operation/tpcc-test.html" class="" aria-label="PolarDB PG TPC-C 测试"><!--[--><!--]--> PolarDB PG TPC-C 测试 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Features"><span class="title">Features</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Features"><span class="title">Features</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>HTAP</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/features/tpch-on-px.html" class="" aria-label="利用 PolarDB HTAP 加速 TPC-H"><!--[--><!--]--> 利用 PolarDB HTAP 加速 TPC-H <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Theory"><span class="title">Theory</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Theory"><span class="title">Theory</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>PolarDB for PostgreSQL</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/theory/arch-overview.html" class="" aria-label="Overview"><!--[--><!--]--> Overview <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/theory/buffer-management.html" class="" aria-label="Buffer Management"><!--[--><!--]--> Buffer Management <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/theory/ddl-synchronization.html" class="" aria-label="DDL Synchronization"><!--[--><!--]--> DDL Synchronization <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/theory/logindex.html" class="" aria-label="LogIndex"><!--[--><!--]--> LogIndex <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>PostgreSQL</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/PolarDB-for-PostgreSQL/theory/analyze.html" class="" aria-label="Code Analysis of ANALYZE"><!--[--><!--]--> Code Analysis of ANALYZE <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Dev"><span class="title">Dev</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Dev"><span class="title">Dev</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/development/dev-on-docker.html" class="" aria-label="Development on Docker"><!--[--><!--]--> Development on Docker <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/development/customize-dev-env.html" class="" aria-label="Customize Development Environment"><!--[--><!--]--> Customize Development Environment <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Contributing"><span class="title">Contributing</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Contributing"><span class="title">Contributing</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/contributing/code-of-conduct.html" class="" aria-label="Code of Conduct"><!--[--><!--]--> Code of Conduct <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/contributing/contributing-polardb-docs.html" class="" aria-label="Contributing Docs"><!--[--><!--]--> Contributing Docs <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/contributing/contributing-polardb-kernel.html" class="" aria-label="Contributing Code"><!--[--><!--]--> Contributing Code <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/contributing/coding-style.html" class="" aria-label="Coding Style"><!--[--><!--]--> Coding Style <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/PolarDB-for-PostgreSQL/operation/backup-and-restore.html" class="router-link-active router-link-exact-active router-link-active" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/PolarDB-for-PostgreSQL/zh/operation/backup-and-restore.html" class="" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/ApsaraDB/PolarDB-for-PostgreSQL" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">Ops <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><p tabindex="0" class="sidebar-item active">Daily Ops <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/PolarDB-for-PostgreSQL/operation/backup-and-restore.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="PolarDB PG 备份恢复"><!--[--><!--]--> PolarDB PG 备份恢复 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/PolarDB-for-PostgreSQL/operation/backup-and-restore.html#备份恢复原理" class="router-link-active router-link-exact-active sidebar-item" aria-label="备份恢复原理"><!--[--><!--]--> 备份恢复原理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/PolarDB-for-PostgreSQL/operation/backup-and-restore.html#目录结构" class="router-link-active router-link-exact-active sidebar-item" aria-label="目录结构"><!--[--><!--]--> 目录结构 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/PolarDB-for-PostgreSQL/operation/backup-and-restore.html#polar-basebackup-备份工具" class="router-link-active router-link-exact-active sidebar-item" aria-label="polar_basebackup 备份工具"><!--[--><!--]--> polar_basebackup 备份工具 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/PolarDB-for-PostgreSQL/operation/backup-and-restore.html#搭建-ro" class="router-link-active router-link-exact-active sidebar-item" aria-label="搭建 RO"><!--[--><!--]--> 搭建 RO <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/PolarDB-for-PostgreSQL/operation/backup-and-restore.html#搭建-standby" class="router-link-active router-link-exact-active sidebar-item" aria-label="搭建 Standby"><!--[--><!--]--> 搭建 Standby <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/PolarDB-for-PostgreSQL/operation/backup-and-restore.html#按时间点恢复" class="router-link-active router-link-exact-active sidebar-item" aria-label="按时间点恢复"><!--[--><!--]--> 按时间点恢复 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/PolarDB-for-PostgreSQL/operation/grow-storage.html" class="sidebar-item" aria-label="PolarDB PG 存储动态扩容"><!--[--><!--]--> PolarDB PG 存储动态扩容 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item">Benchmarks <!----></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/PolarDB-for-PostgreSQL/operation/tpcc-test.html" class="sidebar-item" aria-label="PolarDB PG TPC-C 测试"><!--[--><!--]--> PolarDB PG TPC-C 测试 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="polardb-pg-备份恢复" tabindex="-1"><a class="header-anchor" href="#polardb-pg-备份恢复" aria-hidden="true">#</a> PolarDB PG 备份恢复</h1><p>PolarDB 是基于共享存储的存算分离架构，因此 PolarDB 的备份恢复和 PostgreSQL 存在部分差异。本文将指导您如何对 PolarDB 做备份恢复，搭建只读节点，搭建 Standby 实例等：</p><ol><li>PolarDB 备份恢复原理</li><li>PolarDB 的目录结构</li><li>polar_basebackup 备份工具</li><li>PolarDB 搭建 RO</li><li>PolarDB 搭建 Standby</li><li>PolarDB 按时间点恢复</li></ol><p>前置条件是先准备一个 PolarDB 实例，可以参考文档 <a href="/PolarDB-for-PostgreSQL/deploying/deploy.html" class="">搭建 PolarDB</a>。</p><h2 id="备份恢复原理" tabindex="-1"><a class="header-anchor" href="#备份恢复原理" aria-hidden="true">#</a> 备份恢复原理</h2><p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2022/png/135683/1656473213509-02fd756c-a796-47e0-af3b-cb7ce7e02751.png" alt="theory"></p><p>PolarDB 的备份恢复原理整体上和 PostgreSQL 几乎一致，总结为以下几步：</p><ol><li>执行 <code>pg_start_backup</code> 命令</li><li>使用各种方式对数据库进行复制</li><li>执行 <code>pg_stop_backup</code> 命令</li></ol><p>进行备份的更简单方法是使用 <code>polar_basebackup</code> ，但它其实是在内部发出这些低级命令，并且支持使用网络将文件发送到远端。</p><ul><li><p><code>pg_start_backup</code>：准备进行基本备份。恢复过程从 REDO 点开始，因此 <code>pg_start_backup</code> 必须执行检查点以在开始进行基本备份时显式创建 REDO 点。此外，其检查点的检查点位置必须保存在 <code>pg_control</code> 以外的文件中，因为在备份期间可能会多次执行常规检查点。因此 <code>pg_start_backup</code> 执行以下四个操作：</p><ol><li>强制进入整页写模式。</li><li>切换到当前的 WAL 段文件。</li><li>做检查点。</li><li>创建一个 <code>backup_label</code> 文件——该文件在基础目录的顶层创建，包含关于基础备份本身的基本信息，例如该检查点的检查点位置。 第三和第四个操作是这个命令的核心；执行第一和第二操作以更可靠地恢复数据库集群。</li></ol></li><li><p><code>pg_stop_backup</code>：执行以下五个操作来完成备份。</p><ol><li>如果已被 <code>pg_start_backup</code> 强制更改，则重置为非整页写入模式。</li><li>写一条备份端的 XLOG 记录。</li><li>切换 WAL 段文件。</li><li>创建备份历史文件——该文件包含 <code>backup_label</code> 文件的内容和 <code>pg_stop_backup</code> 已执行的时间戳。</li><li>删除 <code>backup_label</code> 文件 – 从基本备份恢复需要 <code>backup_label</code> 文件，一旦复制，在原始数据库集群中就不需要了。</li></ol></li></ul><h2 id="目录结构" tabindex="-1"><a class="header-anchor" href="#目录结构" aria-hidden="true">#</a> 目录结构</h2><p>如上所述，PolarDB 备份过程总体可以概括为三步，其中第二步是使用各种方式对数据库进行复制：</p><ul><li>手动 copy</li><li>使用网络工具传输</li><li>基于存储进行打快照。</li></ul><p>因此，这里介绍一下 PolarDB 数据目录结构，以便于进一步理解备份恢复。</p><p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2022/png/135683/1656470771553-e0c32f21-2ca4-43a4-a0a8-44d8a15e7358.png" alt="storage"></p><p>如上图，PolarDB 是基于共享存储的，所以 PolarDB 在物理上有两个重要的数据目录，分别是 <strong>本地存储目录</strong> 和 <strong>共享存储目录</strong>。</p><h3 id="本地存储目录" tabindex="-1"><a class="header-anchor" href="#本地存储目录" aria-hidden="true">#</a> 本地存储目录</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>postgres=# show data_directory;
     data_directory
------------------------
 /home/postgres/primary
(1 row)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以通过上述命令在数据库中获取本地存储目录的位置，可以看到它是类似于 PostgreSQL 的数据目录。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>.
├── base
│   ├── 1
│   ├── 13938
│   ├── 13939
│   └── 13940
├── global
├── pg_commit_ts
├── pg_csnlog
├── pg_dynshmem
├── pg_log
├── pg_logical
│   ├── mappings
│   └── snapshots
├── pg_logindex
├── pg_multixact
│   ├── members
│   └── offsets
├── pg_notify
├── pg_replslot
├── pg_serial
├── pg_snapshots
├── pg_stat
├── pg_stat_tmp
├── pg_subtrans
├── pg_tblspc
├── pg_xact
├── polar_cache_trash
├── polar_fullpage
└── polar_rel_size_cache
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>本地存储目录中，大多都是通过 <code>initdb</code> 命令生成的文件或目录。随着数据库服务运行，这里会生成更多的本地文件，如临时文件、缓存文件、配置文件、日志文件。</p><p>由于本地存储目录中的文件不涉及核心数据，因此在做备份时本地存储目录是可选的。您可以仅备份共享存储上的数据目录，然后用 <code>initdb</code> 重新生成一份新的本地存储目录。但是需要记住之前的本地配置信息，如 <code>postgresql.conf</code>，<code>pg_hba.conf</code> 等。</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>如果您不能记住历史配置，或者您需要保留历史日志，建议您将本地存储目录也进行备份。可以将这个目录完全复制后修改配置文件来搭建 RO 或者 Standby。</p></div><h3 id="共享存储目录" tabindex="-1"><a class="header-anchor" href="#共享存储目录" aria-hidden="true">#</a> 共享存储目录</h3><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>postgres<span class="token operator">=</span><span class="token comment"># show polar_datadir;</span>
     polar_datadir
<span class="token comment">-----------------------</span>
 <span class="token operator">/</span>nvme0n1<span class="token operator">/</span>shared_data<span class="token operator">/</span>
<span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">row</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>.
├── base
│   ├── 1
│   ├── 16555
│   ├── 16556
│   ├── 16557
│   └── 16558
├── global
├── pg_commit_ts
├── pg_csnlog
├── pg_logindex
├── pg_multixact
│   ├── members
│   └── offsets
├── pg_replslot
├── pg_tblspc
├── pg_twophase
├── pg_wal
│   └── archive_status
├── pg_xact
├── polar_dma
│   ├── consensus_cc_log
│   └── consensus_log
├── polar_flog
├── polar_flog_index
├── polar_fraindex
│   ├── fbpoint
│   └── pg_xact
└── polar_fullpage
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>共享存储目录中存放 PolarDB 的核心数据文件，如表文件、索引文件、WAL 日志、DMA、LogIndex、Flashback 等。这些文件被一个 RW 节点和多个 RO 节点共享，因此是必须备份的。您可以使用 <code>copy</code> 命令、存储快照、网络传输等方式进行备份。如果您没有更好的选择，推荐使用 <code>polar_basebackup</code> 命令。</p><h2 id="polar-basebackup-备份工具" tabindex="-1"><a class="header-anchor" href="#polar-basebackup-备份工具" aria-hidden="true">#</a> polar_basebackup 备份工具</h2><p>下面介绍一下 PolarDB 的备份工具 <code>polar_basebackup</code>，它由 <a href="https://www.postgresql.org/docs/11/app-pgbasebackup.html" target="_blank" rel="noopener noreferrer"><code>pg_basebackup</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 改造而来，且完全兼容 <code>pg_baseabckup</code>，也就是说它同样可以用于对 PostgreSQL 做备份恢复。<code>polar_basebackup</code> 在 PolarDB 二进制安装目录下的 <code>bin/</code> 目录中，您可以配置 <code>export</code> 环境变量来直接使用它。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>polar_basebackup takes a base backup of a running PostgreSQL server.

Usage:
  polar_basebackup <span class="token punctuation">[</span>OPTION<span class="token punctuation">]</span><span class="token punctuation">..</span>.

Options controlling the output:
  -D, --pgdata<span class="token operator">=</span>DIRECTORY receive base backup into directory
  -F, --format<span class="token operator">=</span>p<span class="token operator">|</span>t       output <span class="token function">format</span> <span class="token punctuation">(</span>plain <span class="token punctuation">(</span>default<span class="token punctuation">)</span>, <span class="token function">tar</span><span class="token punctuation">)</span>
  -r, --max-rate<span class="token operator">=</span>RATE    maximum transfer rate to transfer data directory
                         <span class="token punctuation">(</span>in kB/s, or use suffix <span class="token string">&quot;k&quot;</span> or <span class="token string">&quot;M&quot;</span><span class="token punctuation">)</span>
  -R, --write-recovery-conf
                         <span class="token function">write</span> recovery.conf <span class="token keyword">for</span> replication
  -T, --tablespace-mapping<span class="token operator">=</span>OLDDIR<span class="token operator">=</span>NEWDIR
                         relocate tablespace <span class="token keyword">in</span> OLDDIR to NEWDIR
      --waldir<span class="token operator">=</span>WALDIR    location <span class="token keyword">for</span> the write-ahead log directory
  -X, --wal-method<span class="token operator">=</span>none<span class="token operator">|</span>fetch<span class="token operator">|</span>stream
                         include required WAL files with specified method
  -z, --gzip             compress <span class="token function">tar</span> output
  -Z, --compress<span class="token operator">=</span><span class="token number">0</span>-9     compress <span class="token function">tar</span> output with given compression level

General options:
  -c, --checkpoint<span class="token operator">=</span>fast<span class="token operator">|</span>spread
                         <span class="token builtin class-name">set</span> fast or spread checkpointing
  -C, --create-slot      create replication slot
  -l, --label<span class="token operator">=</span>LABEL      <span class="token builtin class-name">set</span> backup label
  -n, --no-clean         <span class="token keyword">do</span> not clean up after errors
  -N, --no-sync          <span class="token keyword">do</span> not <span class="token function">wait</span> <span class="token keyword">for</span> changes to be written safely to disk
  -P, --progress         show progress information
  -S, --slot<span class="token operator">=</span>SLOTNAME    replication slot to use
  -v, --verbose          output verbose messages
  -V, --version          output version information, <span class="token keyword">then</span> <span class="token builtin class-name">exit</span>
      --no-slot          prevent creation of temporary replication slot
      --no-verify-checksums
                         <span class="token keyword">do</span> not verify checksums
  -?, --help             show this help, <span class="token keyword">then</span> <span class="token builtin class-name">exit</span>

Connection options:
  -d, --dbname<span class="token operator">=</span>CONNSTR   connection string
  -h, --host<span class="token operator">=</span><span class="token environment constant">HOSTNAME</span>    database server <span class="token function">host</span> or socket directory
  -p, --port<span class="token operator">=</span>PORT        database server port number
  -s, --status-interval<span class="token operator">=</span>INTERVAL
                         <span class="token function">time</span> between status packets sent to server <span class="token punctuation">(</span>in seconds<span class="token punctuation">)</span>
  -U, --username<span class="token operator">=</span>NAME    connect as specified database user
  -w, --no-password      never prompt <span class="token keyword">for</span> password
  -W, --password         force password prompt <span class="token punctuation">(</span>should happen automatically<span class="token punctuation">)</span>
      --polardata<span class="token operator">=</span>datadir  receive polar data backup into directory
      --polar_disk_home<span class="token operator">=</span>disk_home  polar_disk_home <span class="token keyword">for</span> polar data backup
      --polar_host_id<span class="token operator">=</span>host_id  polar_host_id <span class="token keyword">for</span> polar data backup
      --polar_storage_cluster_name<span class="token operator">=</span>cluster_name  polar_storage_cluster_name <span class="token keyword">for</span> polar data backup
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到 <code>polar_basebackup</code> 的大部分参数及用法都和 <a href="https://www.postgresql.org/docs/11/app-pgbasebackup.html" target="_blank" rel="noopener noreferrer"><code>pg_basebackup</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 一致，只是多了以下几个参数，下面重点来介绍一下：</p><ul><li><code>polardata</code>： 如果您备份的实例是 PolarDB 共享存储架构，这个参数用于指定 PolarDB 共享存储目录的位置。如果您不指定，将会使用默认目录 <code>polar_shared_data</code>，并且放在本地存储目录（即 <code>-D</code> / <code>--pgdata</code> 所指定的参数）下面。如果您对 PostgreSQL 备份则无需关心他。</li><li><code>polar_disk_home</code>： 如果您备份的实例是 PolarDB 共享存储架构，且您希望将共享存储目录通过 PFS 写入共享存储设备，则需要指定这个参数，它是 PFS 的使用参数。</li><li><code>polar_host_id</code>： 如果您备份的实例是 PolarDB 共享存储架构，且您希望将共享存储目录通过 PFS 写入共享存储设备，则需要指定这个参数，它是 PFS 的使用参数。</li><li><code>polar_storage_cluster_name</code>： 如果您备份的实例是 PolarDB 共享存储架构，且您希望将共享存储目录通过 PFS 写入共享存储设备，则需要指定这个参数，它是 PFS 的使用参数。</li></ul><h2 id="搭建-ro" tabindex="-1"><a class="header-anchor" href="#搭建-ro" aria-hidden="true">#</a> 搭建 RO</h2><p>您可以通过以下两种方式来搭建 RO node。</p><h3 id="使用-initdb-来搭建-ro" tabindex="-1"><a class="header-anchor" href="#使用-initdb-来搭建-ro" aria-hidden="true">#</a> 使用 initdb 来搭建 RO</h3><p>主要步骤是使用 <code>initdb</code> 初始化 RO 的本地存储目录，然后修改配置文件，启动实例。具体请参考 <a href="/PolarDB-for-PostgreSQL/deploying/db-pfs.html#%E5%8F%AA%E8%AF%BB%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2" class="">只读节点部署</a>。</p><h3 id="备份-rw-的本地存储目录来搭建-ro" tabindex="-1"><a class="header-anchor" href="#备份-rw-的本地存储目录来搭建-ro" aria-hidden="true">#</a> 备份 RW 的本地存储目录来搭建 RO</h3><p>这里使用备份 RW 的本地存储目录。下面通过 <code>polar_basebakcup</code> 来演示：</p><div class="language-bash ext-sh"><pre class="language-bash"><code>polar_basebackup --host<span class="token operator">=</span><span class="token punctuation">[</span>主节点所在IP<span class="token punctuation">]</span> --port<span class="token operator">=</span><span class="token number">5432</span> -D /home/postgres/replica1 -X stream --progress --write-recovery-conf -v
</code></pre></div><p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2022/png/135683/1656301721373-90677c11-9e82-4b5b-a60d-ea2e101cf81a.png" alt="undefined"></p><p>完成 <code>polar_basebackup</code> 命令后，我们可以看到 <code>/home/postgres/replica1</code> 中存在一个 <code>polar_shared_data</code>, 搭建 RO 时不需要它，将它删除：</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">rm</span> -rf /home/postgres/replica1/polar_shared_data
</code></pre></div><p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2022/png/135683/1656301745881-219b7540-3190-4cfe-a717-4083d579cc3a.png" alt="undefined"></p><p>打开 <code>/home/postgres/replica1/postgresql.conf</code>，修改如下配置项：</p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">port</span><span class="token punctuation">=</span><span class="token value attr-value">5433</span>
<span class="token key attr-name">polar_hostid</span><span class="token punctuation">=</span><span class="token value attr-value">2</span>
<span class="token key attr-name">polar_enable_shared_storage_mode</span><span class="token punctuation">=</span><span class="token value attr-value">on</span>
<span class="token key attr-name">polar_disk_name</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">nvme0n1</span>&#39;</span>
<span class="token key attr-name">polar_datadir</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">/nvme0n1/shared_data/</span>&#39;</span>
<span class="token key attr-name">polar_vfs.localfs_mode</span><span class="token punctuation">=</span><span class="token value attr-value">off</span>
<span class="token key attr-name">shared_preload_libraries</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">$libdir/polar_vfs,$libdir/polar_worker</span>&#39;</span>
<span class="token key attr-name">polar_storage_cluster_name</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">disk</span>&#39;</span>
<span class="token key attr-name">logging_collector</span><span class="token punctuation">=</span><span class="token value attr-value">on</span>
<span class="token key attr-name">log_line_prefix</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">%p\t%r\t%u\t%m\t</span>&#39;</span>
<span class="token key attr-name">log_directory</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">pg_log</span>&#39;</span>
<span class="token key attr-name">listen_addresses</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">*</span>&#39;</span>
<span class="token key attr-name">max_connections</span><span class="token punctuation">=</span><span class="token value attr-value">1000</span>
<span class="token key attr-name">synchronous_standby_names</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>打开 <code>/home/postgres/replica1/recovery.conf</code>，使用以下配置项替换文件中的所有内容：</p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">polar_replica</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">on</span>&#39;</span>
<span class="token key attr-name">recovery_target_timeline</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">latest</span>&#39;</span>
<span class="token key attr-name">primary_slot_name</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">replica1</span>&#39;</span>
<span class="token key attr-name">primary_conninfo</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;<span class="token inner-value">host=[主节点所在IP] port=5432 user=postgres dbname=postgres application_name=replica1</span>&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最后，启动只读节点：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/pg_ctl start -D <span class="token environment constant">$HOME</span>/replica1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>检查只读节点能否正常运行：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/psql <span class="token punctuation">\</span>
    -p <span class="token number">5433</span> <span class="token punctuation">\</span>
    -d postgres <span class="token punctuation">\</span>
    -c <span class="token string">&#39;select version();&#39;</span>
            version
--------------------------------
 PostgreSQL <span class="token number">11.9</span> <span class="token punctuation">(</span>POLARDB <span class="token number">11.9</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">1</span> row<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="搭建-standby" tabindex="-1"><a class="header-anchor" href="#搭建-standby" aria-hidden="true">#</a> 搭建 Standby</h2><p>您可以使用全量备份集搭建 Standby，这里推荐使用 <code>polar_basebackup</code> 进行搭建，下面介绍搭建流程。</p><h3 id="使用-polar-basebakcup-对实例作全量备份" tabindex="-1"><a class="header-anchor" href="#使用-polar-basebakcup-对实例作全量备份" aria-hidden="true">#</a> 使用 <code>polar_basebakcup</code> 对实例作全量备份</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>polar_basebackup --host<span class="token operator">=</span><span class="token punctuation">[</span>主节点所在IP<span class="token punctuation">]</span> --port<span class="token operator">=</span><span class="token number">5432</span> -D /home/postgres/standby --polardata<span class="token operator">=</span>/nvme0n2/shared_data/  --polar_storage_cluster_name<span class="token operator">=</span>disk --polar_disk_name<span class="token operator">=</span>nvme0n2  --polar_host_id<span class="token operator">=</span><span class="token number">3</span> -X stream --progress --write-recovery-conf -v
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2022/png/135683/1656315576998-2aaeff3e-4341-46df-bce1-eb211ea4c605.png" alt="undefined"></p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>注意：这里是构建共享存储的 Standby，首先您需要找一台机器部署好 PolarDB 及其文件系统 PolarFS，且已经搭建好了共享存储<code>nvme0n2</code>, 具体操作请参考 <a href="/PolarDB-for-PostgreSQL/deploying/deploy.html" class="">准备块设备与搭建文件系统</a></p></div><p>备份完成后如下图所示：</p><p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2022/png/135683/1656315627036-15320d4f-3711-4400-b094-b698edfa8caa.png" alt="undefined"></p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>如果您没有共享存储设备，则不需要指定 <code>--polar_storage_cluster_name</code>，<code>--polar_disk_name</code>，<code>--polar_host_id</code> 参数。</p></div><p>下面我们简单介绍下其他形态的 PolarDB 备份：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>-- 单节点本地备份
polar_basebackup -D /polardb/data-standby -X stream  --progress --write-recovery-conf -v
--共享存储本地备份
polar_basebackup -D /polardb/data-standby --polardata<span class="token operator">=</span>/polardb/data-local  -X stream --progress --write-recovery-conf -v
-- 共享存储写入pfs
polar_basebackup -D /polardb/data-standby --polardata<span class="token operator">=</span>/nvme7n1/data  --polar_storage_cluster_name<span class="token operator">=</span>disk --polar_disk_name<span class="token operator">=</span>nvme7n1  --polar_host_id<span class="token operator">=</span><span class="token number">3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="检查备份是否正常" tabindex="-1"><a class="header-anchor" href="#检查备份是否正常" aria-hidden="true">#</a> 检查备份是否正常</h3><p>查看本地目录：</p><p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2022/png/135683/1656315747873-16bf409d-d58f-4e65-b1e0-1ae0e523b863.png" alt="undefined"></p><p>查看共享存储目录：</p><p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2022/png/135683/1656315649979-c0731ab7-4516-4e5e-9626-93ccdd1abab4.png" alt="undefined"></p><h3 id="修改-postgresql-conf" tabindex="-1"><a class="header-anchor" href="#修改-postgresql-conf" aria-hidden="true">#</a> 修改 postgresql.conf</h3><p>将参数修改为如下所示：</p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">polar_hostid</span> <span class="token punctuation">=</span> <span class="token value attr-value">3</span>
<span class="token key attr-name">polar_disk_name</span> <span class="token punctuation">=</span> <span class="token value attr-value">&#39;<span class="token inner-value">nvme0n2</span>&#39;</span>
<span class="token key attr-name">polar_datadir</span> <span class="token punctuation">=</span> <span class="token value attr-value">&#39;<span class="token inner-value">/nvme0n2/shared_data</span>&#39;</span>
<span class="token key attr-name">polar_storage_cluster_name</span> <span class="token punctuation">=</span> <span class="token value attr-value">&#39;<span class="token inner-value">disk</span>&#39;</span>
<span class="token key attr-name">synchronous_standby_names</span><span class="token punctuation">=</span><span class="token value attr-value">&#39;&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="在主库中创建复制槽" tabindex="-1"><a class="header-anchor" href="#在主库中创建复制槽" aria-hidden="true">#</a> 在主库中创建复制槽</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>psql --host<span class="token operator">=</span><span class="token punctuation">[</span>主节点所在IP<span class="token punctuation">]</span>  --port<span class="token operator">=</span><span class="token number">5432</span> -d postgres -c <span class="token string">&#39;SELECT * FROM pg_create_physical_replication_slot(&#39;</span>standby1<span class="token string">&#39;);&#39;</span>
 slot_name <span class="token operator">|</span> lsn
-----------+-----
 standby1  <span class="token operator">|</span>
<span class="token punctuation">(</span><span class="token number">1</span> row<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="修改-standby-本地目录配置" tabindex="-1"><a class="header-anchor" href="#修改-standby-本地目录配置" aria-hidden="true">#</a> 修改 Standby 本地目录配置</h3><p>在 Standby 的本地存储目录中 <code>recovery.conf</code> 文件中增加如下参数：</p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">recovery_target_timeline</span> <span class="token punctuation">=</span> <span class="token value attr-value">&#39;<span class="token inner-value">latest</span>&#39;</span>
<span class="token key attr-name">primary_slot_name</span> <span class="token punctuation">=</span> <span class="token value attr-value">&#39;<span class="token inner-value">standby1</span>&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="启动-standby" tabindex="-1"><a class="header-anchor" href="#启动-standby" aria-hidden="true">#</a> 启动 Standby</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token environment constant">$HOME</span>/tmp_basedir_polardb_pg_1100_bld/bin/pg_ctl start -D <span class="token environment constant">$HOME</span>/standby
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="验证-standby" tabindex="-1"><a class="header-anchor" href="#验证-standby" aria-hidden="true">#</a> 验证 Standby</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>psql --host<span class="token operator">=</span><span class="token punctuation">[</span>master所在IP<span class="token punctuation">]</span> --port<span class="token operator">=</span><span class="token number">5432</span> -d postgres -c <span class="token string">&quot;create table t(t1 int primary key, t2 int);insert into t values (1, 1),(2, 3),(3, 3);&quot;</span>
CREATE TABLE
INSERT <span class="token number">0</span> <span class="token number">3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>psql --host<span class="token operator">=</span><span class="token punctuation">[</span>standby所在IP<span class="token punctuation">]</span> --port<span class="token operator">=</span><span class="token number">5432</span> -d postgres -c <span class="token string">&#39; select * from t;&#39;</span>
t1 <span class="token operator">|</span> t2
----+----
 <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">1</span>
 <span class="token number">2</span> <span class="token operator">|</span>  <span class="token number">3</span>
 <span class="token number">3</span> <span class="token operator">|</span>  <span class="token number">3</span>
<span class="token punctuation">(</span><span class="token number">3</span> rows<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="按时间点恢复" tabindex="-1"><a class="header-anchor" href="#按时间点恢复" aria-hidden="true">#</a> 按时间点恢复</h2><p>可以参考 PostgreSQL <a href="http://www.postgres.cn/docs/11/continuous-archiving.html" target="_blank" rel="noopener noreferrer">按时间点恢复 PITR<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。其原理如图所示，使用备份集加上归档日志，可以恢复出任意历史时刻的 PolarDB 实例：</p><p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2022/png/135683/1656473229849-8b7dbf39-2830-45e1-a076-adea16c06366.png" alt="undefined"></p></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/ApsaraDB/PolarDB-for-PostgreSQL/edit/main/operation/backup-and-restore.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub"><!--[--><!--]--> Edit this page on GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><!----></footer><nav class="page-nav"><p class="inner"><!----><span class="next"><a href="/PolarDB-for-PostgreSQL/operation/grow-storage.html" class="" aria-label="PolarDB PG 存储动态扩容"><!--[--><!--]--> PolarDB PG 存储动态扩容 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/PolarDB-for-PostgreSQL/assets/app.f10a4800.js" defer></script>
  </body>
</html>
